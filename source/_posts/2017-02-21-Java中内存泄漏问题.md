---
title:  "Java 内存泄漏浅谈"
desc: "java中是否存在内存泄漏？内存泄漏都是出现在什么情况下？"
keywords: "java,GC"
date: 2017-02-21
categories: 
- 编程语言
- Java
tags: 
- Java
- 内存泄漏
- GC
icon: fa-bookmark-o
grammar_code: true
---

Java开发者面试的时候经常会被问倒关于内存泄漏的问题，笔者当时面试的时候也被问到过，近来又翻看JVM虚拟机和java面试笔记这几本书，对java的内存泄漏简单的做个笔记。

<!--more-->

```
1. 垃圾回收中的几种算法
2. 内存泄漏问题
```

### 垃圾回收算法
> **引用计数法**
> 1. 特点：简单、效率低、JVM没采用（很难解决对象之间的相互循环引用）
> 2. 介绍：在堆中每个对象都有一个引用计数器，当对象被引用时，引用计数器加1，当引用被取消的时候，引用计数器减1。

> **追踪回收算法（可达性分析算法）**
> 1. 特点：采用广泛、初始点（GC Roots）的选取有要求：虚拟机栈中引用的对象、方法区中静态属性引用的对象、方法区中常量引用的对象、本地方法栈中JNI引用的对象。
> 2. 介绍：在JVM中利用对象引用图，从 GC Roots出发，向下遍历引用图，同时标记遍历到的对象，当遍历结束是，未被标记的对象就是目前已不被使用的对象，可以被回收。

> **压缩回收算法（标记-整理）**
> 1. 特点：**回收老年代**、会带来性能损失。
> 2. 介绍：标记出要回收的对象，将存活的对象移动到一端，然后清理掉边界以外的内存。

> **复制回收算法**
> 1. 特点：**回收新生代**、消除了内存的碎片、实现简单、运行效率高、内存消耗过高。
> 2. 介绍：将内存划分为大小相等的两块，每次只是用其中的一块，当这一块使用完，将存活的对象复制到另一块上面（紧挨着），然后把已是用过的内存空间一次清理掉。


### 内存泄漏
> **垃圾回收的标准**
> 1. 对象被赋值为null，以后再也没有使用过。
>  2. 对象被赋予了新的值，从新分配了内存空间。

> **内存泄漏的情况**
> 1. 堆中申请的空间没有释放（垃圾回收可以有效解决）。
> 2. 对象已不再使用，但是依然保留在内存中（垃圾回收机制不能保证能有效的解决）。

> **内存泄漏的原因**
> 1. 静态类集合：例如HashMap和Vector，静态类的生命周期是和程序生命周期一致的，那么容器中的对象在程序结束之前不回被释放，这样就会造成内存泄漏。
> 2. 各种连接：数据库连接，网络连接，当建立连接之后，不再使用时，就要要close来释放连接，否则不显示的释放连接，就会造成大量的对象无法回收，从而引起内存泄漏。
> 3. 监听器：通常一个应用中会有多个监听器的存在，如果在释放对象的同时没有将相应的监听器一起删除的话，就可能导致内存泄漏。
> 4. 变量的不合理利用：一般来说如果变量定义的作用用范围大于其适用范围，有可能会造成内存泄漏；如果没有及时的把对象设置为null，也有可能会造成内存泄漏。
